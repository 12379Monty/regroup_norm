<svg width="800" height="500" xmlns="http://www.w3.org/2000/svg">
    <!-- Boxes for the flow diagram -->
    
    <!-- Top level green boxes -->
    <rect x="110" y="50" width="150" height="80" rx="10" ry="10" fill="#d8e8c0" stroke="#8baa56" stroke-width="2"/>
    <rect x="360" y="50" width="190" height="80" rx="10" ry="10" fill="#d8e8c0" stroke="#8baa56" stroke-width="2"/>
    
    <!-- Middle level blue boxes -->
    <rect x="110" y="200" width="150" height="80" rx="10" ry="10" fill="#c4d5f2" stroke="#6889bb" stroke-width="2"/>
    <rect x="360" y="200" width="190" height="80" rx="10" ry="10" fill="#c4d5f2" stroke="#6889bb" stroke-width="2"/>
    <rect x="610" y="200" width="190" height="80" rx="10" ry="10" fill="#c4d5f2" stroke="#6889bb" stroke-width="2"/>
    
    <!-- Bottom level orange boxes -->
    <rect x="360" y="350" width="190" height="120" rx="10" ry="10" fill="#ffdaa3" stroke="#e8a43c" stroke-width="2"/>
    <rect x="610" y="350" width="190" height="120" rx="10" ry="10" fill="#ffdaa3" stroke="#e8a43c" stroke-width="2"/>
    
    <!-- Lines connecting the boxes -->
    <line x1="185" y1="130" x2="185" y2="200" stroke="black" stroke-width="2" marker-end="url(#arrowhead)"/>
    <line x1="455" y1="130" x2="455" y2="200" stroke="black" stroke-width="2" marker-end="url(#arrowhead)"/>
    <line x1="260" y1="240" x2="360" y2="240" stroke="black" stroke-width="2" marker-end="url(#arrowhead)"/>
    <line x1="550" y1="240" x2="610" y2="240" stroke="black" stroke-width="2" marker-end="url(#arrowhead)"/>
    <line x1="455" y1="280" x2="455" y2="350" stroke="black" stroke-width="2"/>
    <line x1="705" y1="280" x2="705" y2="350" stroke="black" stroke-width="2"/>
    
    <!-- Dividing lines in the orange boxes -->
    <line x1="360" y1="410" x2="550" y2="410" stroke="#e8a43c" stroke-width="1.5" stroke-dasharray="3,2"/>
    <line x1="610" y1="410" x2="800" y2="410" stroke="#e8a43c" stroke-width="1.5" stroke-dasharray="3,2"/>
    
    <!-- Text labels -->
    <text x="185" y="90" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">Control Arrays</text>
    <text x="455" y="90" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">Treatment Arrays</text>
    
    <text x="185" y="230" text-anchor="middle" font-family="Arial" font-size="16">Reference Sets</text>
    <text x="185" y="250" text-anchor="middle" font-family="Arial" font-size="16">Assignment</text>
    
    <text x="455" y="230" text-anchor="middle" font-family="Arial" font-size="16">Estimate probe</text>
    <text x="455" y="250" text-anchor="middle" font-family="Arial" font-size="16">parameters</text>
    
    <text x="705" y="230" text-anchor="middle" font-family="Arial" font-size="16">output normalized</text>
    <text x="705" y="250" text-anchor="middle" font-family="Arial" font-size="16">probe signal</text>
    
    <text x="455" y="380" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold">Binary method: μi,low , μi,high</text>
    <text x="455" y="450" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold">Quantile method:      ranki</text>
    
    <text x="705" y="380" text-anchor="middle" font-family="Arial" font-size="14">
        <tspan x="705" dy="0">x̃i = </tspan>
        <tspan x="705" dy="20">(yi - μi,low)</tspan>
        <tspan x="705" dy="20">(μi,high - μi,low)</tspan>
    </text>
    
    <text x="705" y="450" text-anchor="middle" font-family="Arial" font-size="14">x̃i = AvgDistr[ranki]</text>
    
    <!-- Arrow marker definition -->
    <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="black"/>
        </marker>
    </defs>
</svg>
